# Решение проблемы отображения план-графика у клиентов

## Проблема
У клиентов не отображался план-график по объекту, хотя у партнеров Excel файл `schedule.xlsx` был загружен.

## Причина
Клиентский интерфейс использует JSON файл `data.json` для отображения план-графика, а партнерский интерфейс работает напрямую с Excel файлом. При загрузке Excel файла `data.json` не генерировался автоматически.

## Решение

### 1. Добавлен автоматический парсинг Excel файлов
- В `ProjectScheduleController` добавлен метод `generateDataJson()` 
- Метод парсит Excel файл и создает JSON данные для клиентского интерфейса
- Автоматически вызывается при сохранении нового Excel файла

### 2. Добавлена кнопка для ручной генерации
- В партнерском интерфейсе на вкладке "План-график" добавлена кнопка "Обновить данные для клиента"
- Позволяет вручную обновить данные при необходимости

### 3. Автоматическая генерация при обращении клиента
- В клиентском контроллере добавлена логика автоматической генерации `data.json`
- Если файл отсутствует или пуст, система попытается создать его из Excel файла

### 4. Команда Artisan для диагностики
- Создана команда `php artisan schedule:generate-data {project_id}`
- Позволяет проверить и сгенерировать данные для конкретного проекта

## Измененные файлы

1. **app/Http/Controllers/Partner/ProjectScheduleController.php**
   - Добавлен метод `generateDataJson()`
   - Добавлен метод `parseExcelDate()`
   - Обновлен метод `saveFile()` для автоматической генерации JSON

2. **app/Http/Controllers/Client/ProjectController.php**
   - Обновлен метод `getScheduleData()`
   - Добавлены методы для автоматической генерации данных
   - Добавлены недостающие импорты

3. **resources/views/partner/projects/tabs/schedule.blade.php**
   - Добавлена кнопка "Обновить данные для клиента"
   - Добавлен JavaScript обработчик для новой кнопки

4. **routes/web/partner_project_features.php**
   - Добавлен маршрут для генерации данных

5. **app/Console/Commands/GenerateScheduleData.php**
   - Новая команда для диагностики и генерации данных

## Использование

### Для партнеров:
1. Загрузите или обновите Excel файл план-графика
2. При необходимости нажмите кнопку "Обновить данные для клиента"

### Для диагностики:
```bash
php artisan schedule:generate-data 13
```

### Структура данных
Система автоматически парсит Excel столбцы:
- Наименование работы
- Статус 
- Дата начала
- Дата окончания
- Вид работы
- Количество дней

## Результат
Теперь клиенты смогут видеть план-график работ на своей странице проекта в табе "План-график".
